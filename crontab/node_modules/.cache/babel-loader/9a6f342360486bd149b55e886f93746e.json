{"ast":null,"code":"import _slicedToArray from \"/Users/mac/Desktop/\\u6BD5\\u8BBE/\\u6BD5\\u8BBE/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/mac/Desktop/\\u6BD5\\u8BBE/\\u6BD5\\u8BBE/src/component/laout/Login.js\";\nimport React, { useState, useContext, useEffect } from 'react';\nimport { Button, Input, Typography, message, Icon } from 'antd'; // import axios from 'axios'\n\nimport AlertContext from '../../context/alert/alertContext';\nimport axios from 'axios';\n\nconst Login = props => {\n  const alertContext = useContext(AlertContext); //实例化一个context，调用其中state 的方法\n\n  const _useState = useState(''),\n        _useState2 = _slicedToArray(_useState, 2),\n        username = _useState2[0],\n        setName = _useState2[1]; // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n  const _useState3 = useState(''),\n        _useState4 = _slicedToArray(_useState3, 2),\n        password = _useState4[0],\n        setPass = _useState4[1]; // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n  const Text = Typography.Text;\n  useEffect(() => {\n    //useEffect 重构生命周期didMount -- 记住用户的登陆\n    let name = localStorage.getItem('name');\n    let login = localStorage.getItem('login');\n    console.log(name, login);\n\n    if (login) {\n      props.history.push({\n        pathname: '/index'\n      });\n      alertContext.setAlert(\"\\u6B22\\u8FCE\\u56DE\\u6765, \\u5C0A\\u656C\\u7684\".concat(name), \"dark\"); //此处子组件调用父组件方法，通过函数回调的形式进行传值\n    } // eslint-disable-next-line\n\n  }, []);\n\n  const clearData = () => {\n    setName(''); //clear data \n\n    setPass(''); //clear data \n  };\n\n  const handleGoRegister = () => {\n    props.history.push('/regist');\n  }; // 登陆\n\n\n  const handleLogin = e => {\n    let us = username,\n        ps = password;\n\n    if (!us || !ps) {\n      message.info('用户名或密码不能为空');\n      return;\n    }\n\n    ; // eslint-disable-next-line\n\n    axios.post('/user/login', {\n      us,\n      ps\n    }).then(data => {\n      if (data.status === 200) {\n        if (data.data.err === -3) {\n          message.info('用户名或密码不正确！');\n          clearData();\n        } else if (data.data.err === -5) {\n          message.info('该用户已经登陆！');\n          clearData();\n        } else {\n          localStorage.setItem('name', data.data.msg.name); //登陆信息存在本地缓存\n\n          localStorage.setItem('login', data.data.msg.login);\n          localStorage.setItem('_id', data.data.data[0]._id);\n          localStorage.setItem('right', data.data.data[0].right); //1--管理员权限；0--普通用户\n\n          props.history.push({\n            pathname: '/index'\n          });\n          alertContext.setAlert(\"欢迎登陆！\", \"dark\"); //此处子组件调用父组件方法，通过函数回调的形式进行传值\n        }\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }; // 数据双向绑定\n\n\n  const handleNameChange = val => {\n    setName(val.target.value);\n  };\n\n  const handlePassChange = val => {\n    setPass(val.target.value);\n  };\n\n  return React.createElement(\"div\", {\n    className: \"page-login\",\n    style: {\n      backgroundSize: 'cover',\n      width: '100%',\n      height: '100%',\n      backgroundImage: \"url(\" + require(\"../../pic/29.jpg\") + \")\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"login-wrap\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, React.createElement(Text, {\n    strong: true,\n    className: \"linkFont\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, \"\\u897F\\u534E\\u6BD5\\u8BBE\")), React.createElement(\"span\", {\n    className: \"rootFont\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, \"\\u59D3\\u540D\\uFF1A\"), React.createElement(Input, {\n    className: \"login-name loginInp\",\n    value: username,\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u90AE\\u7BB1\\u8D26\\u53F7\",\n    onChange: handleNameChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: \"login-span rootFont\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, \"\\u5BC6\\u7801\\uFF1A\"), React.createElement(Input, {\n    className: \"loginInp\",\n    type: \"password\",\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\",\n    value: password,\n    onChange: handlePassChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"login-btn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, React.createElement(Button, {\n    type: \"primary\",\n    onClick: handleLogin,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, \"\\u767B\\u9646\")), React.createElement(\"div\", {\n    className: \"hover-btn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, React.createElement(Icon, {\n    type: \"login\",\n    className: \"login-icon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: \"loginFont\",\n    onClick: handleGoRegister,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, \"\\u8FD8\\u6CA1\\u8D26\\u53F7\\uFF0C\\u53BB\\u6CE8\\u518C\"))));\n};\n\nexport default Login;","map":{"version":3,"sources":["/Users/mac/Desktop/毕设/毕设/src/component/laout/Login.js"],"names":["React","useState","useContext","useEffect","Button","Input","Typography","message","Icon","AlertContext","axios","Login","props","alertContext","username","setName","password","setPass","Text","name","localStorage","getItem","login","console","log","history","push","pathname","setAlert","clearData","handleGoRegister","handleLogin","e","us","ps","info","post","then","data","status","err","setItem","msg","_id","right","catch","handleNameChange","val","target","value","handlePassChange","backgroundSize","width","height","backgroundImage","require"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\nimport { Button, Input, Typography, message,Icon } from 'antd'\n// import axios from 'axios'\nimport AlertContext from '../../context/alert/alertContext'\nimport axios from 'axios'\n\nconst Login = (props) => {\n\n    const alertContext = useContext(AlertContext) //实例化一个context，调用其中state 的方法\n    const [username, setName] = useState(''); // reactHook 重构： 使用useState重构state，进行状态接管\n    const [password, setPass] = useState(''); // reactHook 重构： 使用useState重构state，进行状态接管\n    const { Text } = Typography\n\n\n    useEffect(() => {  //useEffect 重构生命周期didMount -- 记住用户的登陆\n        let name = localStorage.getItem('name')\n        let login = localStorage.getItem('login')\n        console.log(name, login)\n        if (login) {\n            props.history.push({ pathname: '/index' })\n            alertContext.setAlert(`欢迎回来, 尊敬的${name}`, \"dark\") //此处子组件调用父组件方法，通过函数回调的形式进行传值\n        }\n        // eslint-disable-next-line\n    }, [])\n\n\n\n    const clearData = () => {\n        setName('')   //clear data \n        setPass('')   //clear data \n    }\n\n    const handleGoRegister = () => {\n        props.history.push('/regist')\n    }\n\n\n    // 登陆\n    const handleLogin = (e) => {\n        let us = username,\n            ps = password\n        if (!us || !ps) {\n            message.info('用户名或密码不能为空');\n            return\n        };\n        // eslint-disable-next-line\n        axios.post('/user/login', { us, ps }).\n            then((data) => {\n                if (data.status === 200) {\n                    if (data.data.err === -3) {\n                        message.info('用户名或密码不正确！');\n                        clearData();\n                    }\n                    else if (data.data.err === -5) {\n                        message.info('该用户已经登陆！');\n                        clearData();\n                    }\n                    else {\n                        localStorage.setItem('name', data.data.msg.name) //登陆信息存在本地缓存\n                        localStorage.setItem('login', data.data.msg.login)\n                        localStorage.setItem('_id', data.data.data[0]._id)\n                        localStorage.setItem('right', data.data.data[0].right) //1--管理员权限；0--普通用户\n\n\n                        \n                        props.history.push({ pathname: '/index' })\n                        alertContext.setAlert(\"欢迎登陆！\", \"dark\") //此处子组件调用父组件方法，通过函数回调的形式进行传值\n                    }\n                }\n            })\n            .catch((err) => { console.log(err) });\n    }\n\n    // 数据双向绑定\n    const handleNameChange = (val) => {\n        setName(val.target.value)\n    }\n    const handlePassChange = (val) => {\n        setPass(val.target.value)\n    }\n\n\n    return (\n        <div className=\"page-login\"\n            style={{ backgroundSize: 'cover', width: '100%', height: '100%', backgroundImage: \"url(\" + require(\"../../pic/29.jpg\") + \")\" }}\n        >\n            {/* <Logo/> */}\n            <div className='login-wrap'>\n                <div><Text strong className='linkFont'>西华毕设</Text></div>\n                <span className='rootFont' >姓名：</span>\n                <Input\n                    className='login-name loginInp'\n                    value={username}\n                    placeholder=\"请输入邮箱账号\"\n                    onChange={handleNameChange}\n                />\n                <span className=\"login-span rootFont\">密码：</span>\n                <Input\n                    className=\"loginInp\"\n                    type=\"password\"\n                    placeholder=\"请输入密码\"\n                    value={password}\n                    onChange={handlePassChange}\n                />\n\n                <div className='login-btn'><Button type=\"primary\"\n                    onClick={handleLogin}\n                >登陆</Button></div>\n                <div className='hover-btn'><Icon type='login' className='login-icon' /><span className='loginFont'\n                    onClick={handleGoRegister}\n                >还没账号，去注册</span></div>\n            </div>\n        </div>\n    )\n}\n\n\n\n\n\n\nexport default Login\n\n"]},"metadata":{},"sourceType":"module"}