{"ast":null,"code":"import _slicedToArray from \"/Users/mac/Desktop/\\u6BD5\\u8BBE/\\u6BD5\\u8BBE/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/mac/Desktop/\\u6BD5\\u8BBE/\\u6BD5\\u8BBE/src/component/pages/frontend/People/\\bAccount/AccountEdit/AccountEdit.js\";\nimport React, { useEffect, useState, useContext, useRef } from 'react';\nimport { Typography, Input, Button, Select, message, Icon, Upload } from 'antd';\nimport { Link } from 'react-router-dom';\nimport UserContext from '../../../../../../context/user/userContext';\nimport Spinner from '../../../../../laout/Spinner';\nimport axios from 'axios';\nimport '../AccountEdit/AccountEdit.scss';\n\nconst AccountEdit = props => {\n  const userContext = useContext(UserContext); //实例话context\n\n  const getLoginUser = userContext.getLoginUser,\n        loading = userContext.loading,\n        list = userContext.list;\n  const fileUpload = useRef(null);\n  useEffect(() => {\n    //useEffect 重构生命周期didMount\n    let _id = localStorage.getItem('_id');\n\n    getLoginUser(_id); // eslint-disable-next-line\n  }, []);\n  const name_api = list.name,\n        mail_api = list.mail,\n        phone_api = list.phone,\n        img_api = list.img;\n\n  const _useState = useState(name_api ? name_api : ''),\n        _useState2 = _slicedToArray(_useState, 2),\n        username = _useState2[0],\n        setName = _useState2[1]; // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n  const _useState3 = useState(''),\n        _useState4 = _slicedToArray(_useState3, 2),\n        type = _useState4[0],\n        setType = _useState4[1]; // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n  const _useState5 = useState(phone_api ? phone_api : ''),\n        _useState6 = _slicedToArray(_useState5, 2),\n        phone = _useState6[0],\n        setPhone = _useState6[1]; // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n  const _useState7 = useState(mail_api ? mail_api : ''),\n        _useState8 = _slicedToArray(_useState7, 2),\n        mail = _useState8[0],\n        setMail = _useState8[1]; // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n  const Text = Typography.Text;\n  const Option = Select.Option;\n  const reg = /^([a-zA-Z\\d])(\\w|\\-)+@[a-zA-Z\\d]+\\.[a-zA-Z]{2,4}$/; //邮箱正则验证\n  // 数据双向绑定\n\n  const handleTypeChange = val => {\n    setType(val);\n  };\n\n  const handleNameChange = val => {\n    if (val.target.value.length > 20) {\n      return;\n    }\n\n    setName(val.target.value);\n  };\n\n  const handlePhoneChange = val => {\n    if (val.target.value.length > 35) {\n      return;\n    }\n\n    setPhone(val.target.value);\n  };\n\n  const handleMailChange = val => {\n    if (val.target.value.length > 35) {\n      return;\n    }\n\n    setMail(val.target.value);\n  };\n\n  const clearData = () => {\n    setName('');\n    setType('');\n    setMail('');\n    setPhone('');\n  };\n\n  const handleSubmit = () => {\n    if (!type || !username || !mail || !phone) {\n      message.info('请正确输入用户信息');\n      clearData();\n      return;\n    }\n\n    if (username.length < 2 || username.length > 35) {\n      message.info('用户姓名长度为2-35位之间');\n      clearData();\n      return;\n    }\n\n    if (!reg.test(mail)) {\n      message.info('请输入正确邮箱格式');\n      clearData();\n      return;\n    }\n\n    if (mail.length < 8 || mail.length > 35) {\n      message.info('用户邮箱长度为8-35位之间');\n      clearData();\n      return;\n    }\n\n    if (phone.length < 8 || phone.length > 35) {\n      message.info('联系方式长度为8-35位之间');\n      clearData();\n      return;\n    }\n\n    let _id = localStorage.getItem('_id');\n\n    let sex = type === '男' ? 1 : 2;\n\n    let _phone = parseInt(phone);\n\n    axios.post('user/updateUser', {\n      _id,\n      name: username,\n      sex,\n      mail,\n      phone: _phone\n    }).then(data => {\n      if (data.status === 200) {\n        if (data.data.err === -1) {\n          message.info('参数错误');\n          clearData();\n        } else if (data.data.err === -2) {\n          message.info('服务器错误,请刷新');\n          clearData();\n        } else {\n          message.info('更改成功');\n          clearData();\n          setTimeout(() => {\n            props.history.push({\n              pathname: '/people'\n            });\n          }, 1000);\n        }\n      }\n    });\n  };\n\n  const updateImg = imgUrl => {\n    let _id = localStorage.getItem('_id');\n\n    axios.post('user/updateImg', {\n      _id,\n      img: imgUrl\n    }).then(data => {\n      if (data.status === 200) {\n        if (data.data.err === -1) {\n          message.info('参数错误');\n        } else if (data.data.err === -2) {\n          message.info('服务器错误,请刷新');\n        } else {\n          message.info('上传成功');\n          setTimeout(() => {\n            props.history.push({\n              pathname: '/people'\n            });\n          }, 1000);\n        }\n      }\n    });\n  };\n\n  const handleSubmit2 = () => {\n    let config = {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    };\n\n    if (fileUpload.current.files[0] === undefined) {\n      message.info('请上传文件！');\n      return;\n    }\n\n    let formData = new FormData();\n    formData.append('file', fileUpload.current.files[0]);\n    axios.post('/file/upload', formData, config).then(data => {\n      if (data.status === 200) {\n        if (data.data.err === -1) {\n          message.info('上传文件过大！');\n          return;\n        }\n\n        if (data.data.err === -2) {\n          message.info('上传文件类型不正确！');\n          return;\n        }\n\n        let link = 'http://l1nkkk.xyz';\n        let imgUrl = data.data.img;\n        return updateImg(link + imgUrl);\n      }\n    }).catch(err => {\n      message.ingo(err);\n    });\n  };\n\n  if (loading) {\n    return React.createElement(Spinner, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    });\n  }\n\n  return React.createElement(\"div\", {\n    className: \"AccountEdit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"navText\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, React.createElement(Text, {\n    strong: true,\n    style: {\n      color: '#ff0000'\n    },\n    className: \"navFont\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, \"\\u8D26\\u6237\\u7F16\\u8F91\"), React.createElement(Link, {\n    to: \"/people\",\n    className: \"AccountEdit-link\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, React.createElement(Button, {\n    className: \"AccountEdit-btn\",\n    type: \"danger\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, \"\\u8FD4\\u56DE\"))), React.createElement(\"div\", {\n    className: \"AccountEdit-wrap\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__box\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__div\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, React.createElement(Text, {\n    className: \"AccountEdit-wrap__text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }, \"\\u771F\\u5B9E\\u59D3\\u540D\"), React.createElement(Input, {\n    className: \"AccountEdit-wrap__input\",\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u59D3\\u540D\",\n    value: username,\n    onChange: handleNameChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"checkUnusual-wrap__div\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, React.createElement(Text, {\n    className: \"checkUnusual-wrap__text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, \"\\u6027\\u522B\"), React.createElement(Select, {\n    className: \"checkUnusual-wrap__input\",\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u6027\\u522B\",\n    onChange: handleTypeChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, React.createElement(Option, {\n    value: \"\\u7537\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201\n    },\n    __self: this\n  }, \"\\u7537\"), React.createElement(Option, {\n    value: \"\\u5973\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }, \"\\u5973\")))), \"\\b\", React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__box\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__div\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }, React.createElement(Text, {\n    className: \"Account-wrap__text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, \"\\u7535\\u5B50\\u90AE\\u7BB1\"), React.createElement(Input, {\n    className: \"AccountEdit-wrap__input\",\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u90AE\\u7BB1\",\n    value: mail,\n    onChange: handleMailChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__div\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, React.createElement(Text, {\n    className: \"Account-wrap__text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, \"\\u8054\\u7CFB\\u65B9\\u5F0F\"), React.createElement(Input, {\n    className: \"AccountEdit-wrap__input\",\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u7535\\u8BDD/\\u5EA7\\u673A\",\n    value: phone,\n    type: \"number\",\n    onChange: handlePhoneChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__bottom\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, React.createElement(Button, {\n    className: \"AccountEdit-wrap__bottom--btn\",\n    onClick: handleSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, \"\\u4FDD\\u5B58\"))), React.createElement(\"div\", {\n    className: \"navText\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233\n    },\n    __self: this\n  }, React.createElement(Text, {\n    strong: true,\n    style: {\n      color: '#ff0000'\n    },\n    className: \"navFont\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234\n    },\n    __self: this\n  }, \"\\u5934\\u50CF\\u7F16\\u8F91\")), React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__box\",\n    style: {\n      width: '50%',\n      marginTop: '25px'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__div\",\n    style: {\n      position: 'relative',\n      top: '50px',\n      left: '7%'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }, React.createElement(Text, {\n    className: \"AccountEdit-wrap__text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  }, \"\\u5934\\u50CF\"), React.createElement(\"input\", {\n    type: \"file\",\n    ref: fileUpload,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"AccountEdit-wrap__bottom\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }, React.createElement(Button, {\n    className: \"AccountEdit-wrap__bottom--btn\",\n    onClick: handleSubmit2,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243\n    },\n    __self: this\n  }, \"\\u4FDD\\u5B58\")));\n};\n\nexport default AccountEdit; //","map":{"version":3,"sources":["/Users/mac/Desktop/毕设/毕设/src/component/pages/frontend/People/\bAccount/AccountEdit/AccountEdit.js"],"names":["React","useEffect","useState","useContext","useRef","Typography","Input","Button","Select","message","Icon","Upload","Link","UserContext","Spinner","axios","AccountEdit","props","userContext","getLoginUser","loading","list","fileUpload","_id","localStorage","getItem","name_api","name","mail_api","mail","phone_api","phone","img_api","img","username","setName","type","setType","setPhone","setMail","Text","Option","reg","handleTypeChange","val","handleNameChange","target","value","length","handlePhoneChange","handleMailChange","clearData","handleSubmit","info","test","sex","_phone","parseInt","post","then","data","status","err","setTimeout","history","push","pathname","updateImg","imgUrl","handleSubmit2","config","headers","current","files","undefined","formData","FormData","append","link","catch","ingo","color","width","marginTop","position","top","left"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext, useRef } from 'react'\nimport { Typography, Input, Button, Select, message, Icon, Upload } from 'antd'\nimport { Link } from 'react-router-dom'\nimport UserContext from '../../../../../../context/user/userContext'\nimport Spinner from '../../../../../laout/Spinner'\nimport axios from 'axios'\nimport '../AccountEdit/AccountEdit.scss'\n\n\n\n\nconst AccountEdit = (props) => {\n    const userContext = useContext(UserContext) //实例话context\n    const { getLoginUser, loading, list } = userContext\n\n    const fileUpload = useRef(null)\n\n\n\n    useEffect(() => {  //useEffect 重构生命周期didMount\n        let _id = localStorage.getItem('_id')\n        getLoginUser(_id)\n        // eslint-disable-next-line\n    }, [])\n    const { name: name_api, mail: mail_api, phone: phone_api, img: img_api } = list\n\n\n    const [username, setName] = useState(name_api ? name_api : ''); // reactHook 重构： 使用useState重构state，进行状态接管\n    const [type, setType] = useState(''); // reactHook 重构： 使用useState重构state，进行状态接管\n    const [phone, setPhone] = useState(phone_api ? phone_api : ''); // reactHook 重构： 使用useState重构state，进行状态接管\n    const [mail, setMail] = useState(mail_api ? mail_api : ''); // reactHook 重构： 使用useState重构state，进行状态接管\n\n\n\n    const { Text } = Typography\n    const { Option } = Select\n    const reg = /^([a-zA-Z\\d])(\\w|\\-)+@[a-zA-Z\\d]+\\.[a-zA-Z]{2,4}$/ //邮箱正则验证\n\n\n    // 数据双向绑定\n    const handleTypeChange = (val) => {\n        setType(val)\n    }\n    const handleNameChange = (val) => {\n        if (val.target.value.length > 20) { return }\n        setName(val.target.value)\n    }\n    const handlePhoneChange = (val) => {\n        if (val.target.value.length > 35) { return }\n        setPhone(val.target.value)\n    }\n    const handleMailChange = (val) => {\n        if (val.target.value.length > 35) { return }\n        setMail(val.target.value)\n    }\n\n    const clearData = () => {\n        setName('')\n        setType('')\n        setMail('')\n        setPhone('')\n    }\n    const handleSubmit = () => {\n        if (!type || !username || !mail || !phone) {\n            message.info('请正确输入用户信息')\n            clearData()\n            return\n        }\n        if (username.length < 2 || username.length > 35) {\n            message.info('用户姓名长度为2-35位之间')\n            clearData()\n            return\n        }\n        if (!reg.test(mail)) {\n            message.info('请输入正确邮箱格式')\n            clearData()\n            return\n        }\n        if (mail.length < 8 || mail.length > 35) {\n            message.info('用户邮箱长度为8-35位之间')\n            clearData()\n            return\n        }\n        if (phone.length < 8 || phone.length > 35) {\n            message.info('联系方式长度为8-35位之间')\n            clearData()\n            return\n        }\n        let _id = localStorage.getItem('_id')\n        let sex = type === '男' ? 1 : 2\n        let _phone = parseInt(phone)\n\n        axios.post('user/updateUser', { _id, name: username, sex, mail, phone: _phone }).then(\n            (data) => {\n                if (data.status === 200) {\n                    if (data.data.err === -1) {\n                        message.info('参数错误');\n                        clearData();\n                    }\n                    else if (data.data.err === -2) {\n                        message.info('服务器错误,请刷新');\n                        clearData();\n                    }\n                    else {\n                        message.info('更改成功');\n                        clearData();\n                        setTimeout(() => {\n                            props.history.push({ pathname: '/people' })\n                        }, 1000)\n                    }\n                }\n            })\n\n    }\n    const updateImg = (imgUrl) => {\n        let _id = localStorage.getItem('_id')\n        axios.post('user/updateImg', { _id, img: imgUrl }).then(\n            (data) => {\n                if (data.status === 200) {\n                    if (data.data.err === -1) {\n                        message.info('参数错误');\n                    }\n                    else if (data.data.err === -2) {\n                        message.info('服务器错误,请刷新');\n                    }\n                    else {\n                        message.info('上传成功');\n                        setTimeout(() => {\n                            props.history.push({ pathname: '/people' })\n                        }, 1000)\n                    }\n                }\n            })\n    }\n\n    const handleSubmit2 = () => {\n        let config = {\n            headers: {\n                'Content-Type': 'multipart/form-data'\n            }\n        }\n\n        if (fileUpload.current.files[0] === undefined) {\n            message.info('请上传文件！')\n            return\n        }\n        let formData = new FormData()\n        formData.append('file', fileUpload.current.files[0])\n\n\n        axios.post('/file/upload', formData,config).then(data => {\n            if (data.status === 200) {\n                if (data.data.err === -1) {\n                    message.info('上传文件过大！')\n                    return\n                }\n                if (data.data.err === -2) {\n                    message.info('上传文件类型不正确！')\n                    return\n                }\n                let link = 'http://l1nkkk.xyz'\n                let imgUrl = data.data.img\n\n                return updateImg(link+imgUrl)\n\n            }\n        }).catch(err => {\n            message.ingo(err)\n        })\n\n\n    }\n\n\n\n    if (loading) { return (<Spinner></Spinner>) }\n    return (\n        <div className='AccountEdit'>\n            <div className='navText'>\n                <Text strong style={{ color: '#ff0000' }} className='navFont'>账户编辑</Text>\n                <Link to='/people' className='AccountEdit-link' ><Button className='AccountEdit-btn' type='danger'>返回</Button></Link>\n            </div>\n            <div className='AccountEdit-wrap'>\n                <div className='AccountEdit-wrap__box'>\n                    <div className='AccountEdit-wrap__div'>\n                        <Text className=\"AccountEdit-wrap__text\">真实姓名</Text>\n                        <Input\n                            className=\"AccountEdit-wrap__input\"\n                            placeholder=\"请输入姓名\"\n                            value={username}\n                            onChange={handleNameChange}\n                        />\n                    </div>\n                    <div className='checkUnusual-wrap__div'>\n                        <Text className=\"checkUnusual-wrap__text\">性别</Text>\n                        <Select\n                            className=\"checkUnusual-wrap__input\"\n                            placeholder=\"请选择性别\"\n                            onChange={handleTypeChange}\n                        >\n                            <Option value='男'>男</Option>\n                            <Option value='女'>女</Option>\n                        </Select>\n                    </div>\n                </div>\n                \b\n                <div className='AccountEdit-wrap__box'>\n                    <div className='AccountEdit-wrap__div'>\n                        <Text className=\"Account-wrap__text\">电子邮箱</Text>\n                        <Input\n                            className=\"AccountEdit-wrap__input\"\n                            placeholder=\"请输入邮箱\"\n                            value={mail}\n                            onChange={handleMailChange}\n                        />\n                    </div>\n                    <div className='AccountEdit-wrap__div'>\n                        <Text className=\"Account-wrap__text\">联系方式</Text>\n                        <Input\n                            className=\"AccountEdit-wrap__input\"\n                            placeholder=\"请输入电话/座机\"\n                            value={phone}\n                            type='number'\n                            onChange={handlePhoneChange}\n                        />\n                    </div>\n                </div>\n\n                <div className='AccountEdit-wrap__bottom'>\n                    <Button className='AccountEdit-wrap__bottom--btn' onClick={handleSubmit}>保存</Button>\n                </div>\n            </div>\n            <div className='navText'>\n                <Text strong style={{ color: '#ff0000' }} className='navFont'>头像编辑</Text>\n            </div>\n            <div className='AccountEdit-wrap__box' style={{ width: '50%', marginTop: '25px' }}>\n                <div className='AccountEdit-wrap__div' style={{ position: 'relative', top: '50px', left: '7%' }}>\n                    <Text className=\"AccountEdit-wrap__text\">头像</Text>\n                    <input type=\"file\" ref={fileUpload} />\n                </div>\n            </div>\n            <div className='AccountEdit-wrap__bottom'>\n                <Button className='AccountEdit-wrap__bottom--btn' onClick={handleSubmit2}>保存</Button>\n            </div>\n        </div>\n    )\n}\n\nexport default AccountEdit\n\n\n\n//\n\n"]},"metadata":{},"sourceType":"module"}