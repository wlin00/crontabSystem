{"ast":null,"code":"import _slicedToArray from \"/Users/mac/Desktop/\\u6BD5\\u8BBE/\\u6BD5\\u8BBE/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/mac/Desktop/\\u6BD5\\u8BBE/\\u6BD5\\u8BBE/src/context/monitor/monitorState.js\";\nimport React, { useReducer } from 'react';\nimport MonitorContext from './monitorContext';\nimport MonitorReducer from './monitorReducer';\nimport axios from 'axios';\nimport { message } from 'antd';\nimport { GET_MONITOR, SET_LOADING, GET_DETAIL, SET_ID, CLEAR_ID } from '../type';\n\nconst MonitorState = props => {\n  //初始化状态\n  const initialState = {\n    monitor: {},\n    detail: {},\n    loading: false,\n    total: 0,\n    currentId: 0\n  }; //使用useReducer，即state关联Reducer\n\n  const _useReducer = useReducer(MonitorReducer, initialState),\n        _useReducer2 = _slicedToArray(_useReducer, 2),\n        state = _useReducer2[0],\n        dispatch = _useReducer2[1]; //函数参数1：当前提交的reduver       函数参数2：当前提交的状态值 ；\n  //实现方法区域                                                          \n  //getMonitor\n\n\n  const getMonitor = async () => {\n    //根据login名获取user信息\n    setLoading(true); //只要开始请求数据，更改为loading状态\n\n    const res = await axios.get('/api/hosts/status', {});\n\n    if (res.status !== 200) {\n      message.info('请求错误');\n      setLoading(false);\n      return;\n    }\n\n    dispatch({\n      type: GET_MONITOR,\n      payload: {\n        monitor: res.data,\n        total: res.data.length\n      }\n    });\n    setLoading(false);\n  }; // api/graphs/?host_id=3&time_range=latest  \n  //getMonitorDetail\n\n\n  const getMonitorDetail = async id => {\n    //根据login名获取user信息\n    setLoading(true); //只要开始请求数据，更改为loading状态\n\n    let res = null;\n\n    try {\n      res = await axios.get(\"/api/graphs/?host_id=\".concat(id, \"&time_range=latest\"));\n    } catch (err) {\n      message.info(err);\n      return Promise.reject();\n    }\n\n    if (res.status !== 200) {\n      message.info('请求错误');\n      setLoading(false);\n      return;\n    }\n\n    dispatch({\n      type: GET_DETAIL,\n      payload: {\n        detail: res.data[0].data\n      }\n    });\n    setLoading(false);\n  }; //set loading\n\n\n  const setLoading = loading => {\n    dispatch({\n      type: SET_LOADING,\n      //使用dispatch提交到Reducer中\n      payload: {\n        loading\n      }\n    });\n  }; //设置当前主机id\n\n\n  const setId = id => {\n    console.log('set!!id', id);\n    dispatch({\n      type: SET_ID,\n      payload: {\n        id\n      }\n    });\n  }; //页面销毁，清除当前主机id\n\n\n  const clearId = () => {\n    dispatch({\n      type: CLEAR_ID\n    });\n  };\n\n  return React.createElement(MonitorContext.Provider, {\n    value: {\n      monitor: state.monitor,\n      loading: state.loading,\n      total: state.total,\n      detail: state.detail,\n      currentId: state.currentId,\n      setLoading,\n      getMonitor,\n      getMonitorDetail,\n      setId,\n      clearId\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, props.children);\n};\n\nexport default MonitorState;","map":{"version":3,"sources":["/Users/mac/Desktop/毕设/毕设/src/context/monitor/monitorState.js"],"names":["React","useReducer","MonitorContext","MonitorReducer","axios","message","GET_MONITOR","SET_LOADING","GET_DETAIL","SET_ID","CLEAR_ID","MonitorState","props","initialState","monitor","detail","loading","total","currentId","state","dispatch","getMonitor","setLoading","res","get","status","info","type","payload","data","length","getMonitorDetail","id","err","Promise","reject","setId","console","log","clearId","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport MonitorContext from './monitorContext';\nimport MonitorReducer from './monitorReducer';\nimport axios from 'axios'\nimport {message} from 'antd'\n\nimport { GET_MONITOR, SET_LOADING,GET_DETAIL,SET_ID,CLEAR_ID } from '../type'\n\n\n\nconst MonitorState = props => {\n    //初始化状态\n    const initialState = {\n        monitor: {},\n        detail:{},\n        loading: false,\n        total:0,\n        currentId:0\n\n    };\n\n    //使用useReducer，即state关联Reducer\n    const [state, dispatch] = useReducer(MonitorReducer, initialState) //函数参数1：当前提交的reduver       函数参数2：当前提交的状态值 ；\n\n    //实现方法区域                                                          \n    //getMonitor\n    const getMonitor = async () => { //根据login名获取user信息\n        setLoading(true)//只要开始请求数据，更改为loading状态\n        const res = await axios.get('/api/hosts/status',{})\n        if(res.status!==200){\n            message.info('请求错误')\n            setLoading(false)\n            return\n        }\n        dispatch({\n            type: GET_MONITOR,\n            payload: {\n                monitor: res.data,\n                total:res.data.length\n            }\n        })\n        setLoading(false)\n    };\n    // api/graphs/?host_id=3&time_range=latest  \n\n\n      //getMonitorDetail\n      const getMonitorDetail = async (id) => { //根据login名获取user信息\n        setLoading(true)//只要开始请求数据，更改为loading状态\n        let res = null\n        try{\n           res = await axios.get(`/api/graphs/?host_id=${id}&time_range=latest`)\n        }\n        catch(err){\n            message.info(err)\n            return Promise.reject()\n        }\n        if(res.status!==200){\n            message.info('请求错误')\n            setLoading(false)\n            return\n        }\n        dispatch({\n            type: GET_DETAIL,\n            payload: {\n                detail: res.data[0].data,\n            }\n        })\n        setLoading(false)\n    };\n   \n    //set loading\n    const setLoading = (loading) => {\n        dispatch({\n            type: SET_LOADING, //使用dispatch提交到Reducer中\n            payload: { loading }\n        })\n    }\n\n    //设置当前主机id\n    const setId = (id)=>{\n        console.log('set!!id',id)\n        dispatch({\n            type:SET_ID,\n            payload:{id}\n        })\n    }\n\n    //页面销毁，清除当前主机id\n    const clearId= ()=>{\n        dispatch({\n            type:CLEAR_ID,\n        })\n        \n    }\n\n    return (<MonitorContext.Provider value={{\n        monitor: state.monitor,\n        loading: state.loading,\n        total:state.total,\n        detail:state.detail,\n        currentId:state.currentId,\n\n        setLoading,\n        getMonitor,\n        getMonitorDetail,\n        setId,\n        clearId\n    }}>{props.children}</MonitorContext.Provider>)\n\n\n}\nexport default MonitorState\n"]},"metadata":{},"sourceType":"module"}